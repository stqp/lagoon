# Kibanaの例

[キバナの始め方のビデオ](https://www.elastic.co/webinars/getting-started-kibana)を見て、ログの操作に取り組む準備ができましたか？ 私たちはここで助けを提供します！ このページでは、使用できるKibanaのクエリの例を提供します。これはKibana 101のクラスではありませんが、Kibanaで何ができるのかを理解するのに役立ちます。

始める準備はできましたか？ よし！

!!! 注意
    開始する前にテナントを選択していることを確認してください！ 左側のメニューにある `Tenant` アイコンをクリックしてそれを行うことができます。 テナントを選択したら、再度 `Discover` アイコンをクリックして始めてください。

## ルーターログ

以下に、2つの一般的なログリクエストの例を示します：

* あなたのサイトへのヒット/リクエストの総数を表示します。
* 特定のIPアドレスからのヒット/リクエストの数を表示します。

### サイトへのヒット/リクエストの総数

* Kibanaを起動し、`Discovery` を選択しましょう（以下のスクリーンショットの＃1）
* 次にあなたのプロジェクトのルーターログ（＃2）。
* そこから、この情報を少し絞り込みます。私たちの主な製品環境に焦点を当てましょう。
* 検索バー（＃3）に入力します：

  `openshift_project: "製品プロジェクトの名前"`

* これにより、すべての 指定された時間枠内での生産環境へのヒット数。
* 右上の角(#4)で時間枠を変更できます。
* エントリの隣の矢印(#5)をクリックすると、それが展開されて、すべてのキャプチャされた情報が表示されます。
* フィールドの上にマウスを置いて左側の追加をクリックすることで、そのフィールドをウィンドウに追加できます(#6)。
* また、検索バーを使用して結果をさらにフィルタリングすることもできます。

![Kibanaでサイトへの総ヒット数/リクエスト数を取得する方法](../images/kibana_example1.png)

### 特定のIPアドレスからのヒット数/リクエスト数

上記のクエリを実行すると、サイトへの全トラフィックを一般的に見ることができますが、特定のIPアドレスに絞り込む場合はどうでしょうか？ たとえば、IPがサイトを何回ヒットしたか、そして彼らが具体的にどのページを見ていたかを見たいかもしれません。次のクエリはその手助けになるはずです。

まず、上記と同じクエリから始めますが、いくつかの項目を追加します。

* 最初に、次のフィールドを追加します：`client_ip` と `http_request`。
* これにより、すべてのIPアドレスとそのリクエストしたページのリストが表示されます。次は、Amazee.ioページの場合の表示内容です：

![すべてのIPアドレスとそのリクエストしたページ：]( 要求された。](../images/kibana_example2.png)

これは良さそうですが、特定のIPアドレスからのリクエストだけを表示したい場合はどうするのでしょうか？検索条件にアドレスを追加することでフィルタリングできます。

* 追加する内容：`AND client_ip: "IPアドレス"`.
* これにより、その特定のIPアドレスからのヒットと、そのアドレスから要求されたページだけが結果に表示されます。ここに私たちのAmazee.ioウェブサイトの例を示します：

![特定のIPアドレスからのヒット。](../images/kibana_example3.png)

## コンテナログ

コンテナログは、特定のコンテナとプロジェクトのすべての`stout`と`sterr`メッセージを表示します。特定のコンテナからログを取得し、そのコンテナ内で特定のエラー番号を見つける例を示します。

### コンテナからのログ

特定のコンテナ（php、nginxなど）のログを見たいですか？このセクションが役立ちます！NGINXのログを見ることに焦点を当ててみましょう。

* Kibanaを開き、Discoverを選択します（下のスクリーンショットの＃1）。
* そこから、プロジェクトのコンテナログを選択します（＃2）。
* 検索バー（＃3）に移動し、`kubernetes.container_name: "nginx"`を入力します。
* これにより、プロジェクトのすべてのNGINXログが表示されます。 エントリー（＃4）の隣の矢印をクリックすると、そのエントリーが展開され、収集したすべての情報が表示されます。
* ビューにメッセージフィールドとレベルフィールドを追加しましょう。左側の「追加」をクリックすることでそれができます（＃5）。
* 画面の右上隅（＃6）で時間枠を変更することができます。以下の例では、過去4時間のログを見ています。

![](../images/kibana_example4.png)

### ログの特定のエラー

あなたのNGINXコンテナでいくつの500 Internal Serverエラーが発生したかを知りたいですか？検索クエリを変更することでそれが可能です。もし検索するなら：

`kubernetes.container_name: "nginx" AND message: "500"`

それはNGINXコンテナの500エラーメッセージのみを表示します。あなたが望む任意のコンテナで任意のエラーメッセージを検索することができます！

## 可視化

Kibanaは、可視化やグラフを作成するオプションも提供します。私たちは、上記で使用した同じクエリを使用して、1ヶ月間のヒット数/リクエスト数を示すチャートを作成します。

1. Kibanaの左側にあるVisualizeをクリックします。
2. 青いプラス記号をクリックします。
3. この例では、垂直バーチャートを選択します。
4. プロジェクトのルーターログを選択します .
5. バケツの下のX軸をクリックし、間隔を日次に設定した日付ヒストグラムを選択します
6. 成功!! これで、毎日のトラフィックを示す素晴らしい棒グラフが表示されるはずです。

!!! 注意
    右上隅のデータの適切な時間枠を選択することを確認してください。

以下は、日次ヒットの視覚化チャートの例です:

![日次ヒット視覚化チャート.](../images/kibana_example5.png)

また、視覚化（および検索）を保存できることにも注意してください！ それにより、将来的にそれらにより迅速にアクセスできます。 そして、各アカウントが自分のKibanaテナントを持っているため、検索や視覚化は他のアカウントと共有されません。

## トラブルシューティング

<iframe width="560" height="315" src="https://www.youtube.com/embed/BuQo5J0Qc2c" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>